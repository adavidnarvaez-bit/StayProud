<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Disponibilidad | StayProud</title>

  <style>
    :root{
      --brand:#00bfa6;
      --bg:#f6f7f8;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --line:#e5e7eb;
      --danger:#ef4444;
    }

    *{ box-sizing:border-box; }
    body{ margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial; background:var(--bg); color:var(--text); }

    /* NAV */
    header{ background:var(--brand); color:white; position:sticky; top:0; z-index:10; }
    .nav-wrap{ max-width:1100px; margin:0 auto; padding:14px 16px; display:flex; align-items:center; justify-content:space-between; gap:14px; }
    .brand{ display:flex; align-items:center; gap:10px; text-decoration:none; color:white; font-weight:700; }
    .brand img{ width:34px; height:34px; object-fit:contain; background:white; border-radius:8px; padding:4px; }
    .nav{ display:flex; gap:14px; align-items:center; }
    .nav a{ color:white; text-decoration:none; font-weight:600; padding:8px 10px; border-radius:10px; opacity:.95; }
    .nav a:hover{ background:rgba(255,255,255,.18); }
    .nav a.active{ background:rgba(255,255,255,.22); outline:2px solid rgba(255,255,255,.35); }

    /* Layout */
    .container{ max-width:1100px; margin:0 auto; padding:18px 16px 50px; }
    .grid{ display:grid; grid-template-columns: 1.15fr .85fr; gap:16px; }
    @media (max-width:900px){
      .grid{ grid-template-columns:1fr; }
    }

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:16px;
      box-shadow:0 10px 25px rgba(2,6,23,.06);
      padding:16px;
    }

    h1{ margin:0 0 8px; font-size:22px; }
    .sub{ margin:0 0 16px; color:var(--muted); }

    /* Calendar */
    .cal-head{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px; }
    .cal-title{ font-weight:800; letter-spacing:.5px; }
    .cal-actions{ display:flex; gap:8px; }
    .btn{
      border:1px solid var(--line);
      background:white;
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:700;
    }
    .btn:hover{ border-color:#cbd5e1; }
    .btn.primary{
      background:var(--brand);
      border-color:var(--brand);
      color:white;
    }
    .btn.primary:hover{ filter:brightness(.98); }

    .dow{ display:grid; grid-template-columns:repeat(7,1fr); gap:8px; color:var(--muted); font-weight:700; font-size:12px; margin:10px 0 8px; }
    .grid-days{ display:grid; grid-template-columns:repeat(7,1fr); gap:8px; }

    .day{
      border:1px solid var(--line);
      background:white;
      border-radius:14px;
      padding:10px 10px;
      min-height:54px;
      display:flex;
      align-items:flex-start;
      justify-content:flex-start;
      font-weight:800;
      cursor:pointer;
      position:relative;
      user-select:none;
    }
    .day.muted{ opacity:.35; cursor:default; }
    .day.blocked{
      background:#fff1f2;
      border-color:#fecdd3;
      color:#9f1239;
      cursor:not-allowed;
    }
    .day.selected{ outline:3px solid rgba(0,191,166,.35); border-color:var(--brand); }
    .day.inrange{ background:rgba(0,191,166,.10); border-color:rgba(0,191,166,.35); }

    .badge{
      position:absolute;
      bottom:8px;
      right:10px;
      font-size:10px;
      font-weight:800;
      color:var(--muted);
    }
    .blocked .badge{ color:#9f1239; }

    /* Form / summary */
    .row{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    @media (max-width:520px){ .row{ grid-template-columns:1fr; } }

    label{ display:block; font-size:12px; color:var(--muted); margin:10px 0 6px; font-weight:800; }
    input, select{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:white;
      font-size:14px;
      outline:none;
    }
    input:focus, select:focus{ border-color:rgba(0,191,166,.6); box-shadow:0 0 0 4px rgba(0,191,166,.12); }

    .kpi{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:10px;
      margin-top:12px;
    }
    .kpi .box{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      background:#fff;
    }
    .kpi .t{ font-size:12px; color:var(--muted); font-weight:800; }
    .kpi .v{ font-size:18px; font-weight:900; margin-top:6px; }

    .note{ margin-top:10px; color:var(--muted); font-size:12px; }
    .warn{ color:var(--danger); font-weight:800; margin-top:10px; }

    footer{ text-align:center; padding:18px; color:var(--muted); font-size:12px; }
  </style>
</head>

<body>
  <header>
    <div class="nav-wrap">
      <a class="brand" href="index.html">
        <!-- Ajusta este path si tu logo está en img/logo.png -->
        <img src="img/logo.png" alt="StayProud">
        <span>StayProud</span>
      </a>

      <nav class="nav" id="mainNav">
        <a href="index.html">Inicio</a>
        <a href="servicios.html">Servicios</a>
        <a href="nosotros.html">Nosotros</a>
        <a href="alojamientos.html">Alojamientos</a>
        <a class="active" href="disponibilidad.html">Reservas</a>
        <a href="contactanos.html">Contáctanos</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <div class="grid">
      <!-- CALENDARIO -->
      <section class="card">
        <h1>Selecciona las fechas de tu estancia</h1>
        <p class="sub">Haz clic en una fecha de entrada y luego en una fecha de salida. Las fechas ocupadas quedan bloqueadas.</p>

        <div class="cal-head">
          <div class="cal-title" id="monthLabel">—</div>
          <div class="cal-actions">
            <button class="btn" id="prevBtn" type="button">◀</button>
            <button class="btn" id="todayBtn" type="button">Hoy</button>
            <button class="btn" id="nextBtn" type="button">▶</button>
          </div>
        </div>

        <div class="dow">
          <div>Do</div><div>Lu</div><div>Ma</div><div>Mi</div><div>Ju</div><div>Vi</div><div>Sá</div>
        </div>

        <!-- IMPORTANTÍSIMO: ESTE contenedor es donde aparece el calendario -->
        <div class="grid-days" id="calendarGrid"></div>

        <div class="note">
          <b>Tip:</b> Si no se ve nada, abre <b>F12 → Console</b>. Si hay un error, el calendario no se dibuja.
        </div>
      </section>

      <!-- FORM + CÁLCULO -->
      <aside class="card">
        <h1>Tu reserva</h1>
        <p class="sub">Calculamos noches y total automáticamente.</p>

        <div class="row">
          <div>
            <label>Fecha de entrada</label>
            <input id="checkIn" type="text" placeholder="Selecciona en el calendario" readonly>
          </div>
          <div>
            <label>Fecha de salida</label>
            <input id="checkOut" type="text" placeholder="Selecciona en el calendario" readonly>
          </div>
        </div>

        <label>Tipo de habitación</label>
        <select id="roomType">
          <option value="60">Habitación por persona — 60 €/noche</option>
          <option value="80">Habitación por pareja — 80 €/noche</option>
          <option value="120">Alojamiento entero — 120 €/noche</option>
        </select>

        <div class="row">
          <div>
            <label>Huéspedes</label>
            <input id="guests" type="number" min="1" value="2">
          </div>
          <div>
            <label>Email</label>
            <input id="email" type="email" placeholder="tucorreo@gmail.com">
          </div>
        </div>

        <label>Nombre y apellidos</label>
        <input id="fullName" type="text" placeholder="Tu nombre completo">

        <div class="kpi">
          <div class="box">
            <div class="t">Noches</div>
            <div class="v" id="nights">0</div>
          </div>
          <div class="box">
            <div class="t">Precio por noche</div>
            <div class="v" id="priceNight">0 €</div>
          </div>
          <div class="box">
            <div class="t">Total reserva</div>
            <div class="v" id="total">0 €</div>
          </div>
        </div>

        <div class="warn" id="warning" style="display:none;"></div>

        <div style="display:flex; gap:10px; margin-top:14px;">
          <button class="btn" id="clearBtn" type="button" style="flex:1;">Limpiar</button>
          <button class="btn primary" id="confirmBtn" type="button" style="flex:1;">Confirmar</button>
        </div>

        <div class="note">
          * El envío al correo requiere backend (PHP/Node). Aquí dejamos listo el <b>resumen</b>; luego lo conectamos.
        </div>
      </aside>
    </div>
  </main>

  <footer>© 2025 StayProud. Todos los derechos reservados.</footer>

  <script>
    // ====== CONFIG ======
    // Fechas ocupadas (bloqueadas). Formato: "YYYY-MM-DD"
    // Cambia/añade las que quieras:
    const blockedDates = new Set([
      "2025-11-26",
      "2025-11-27",
      "2025-11-28"
    ]);

    const monthNames = [
      "ENERO","FEBRERO","MARZO","ABRIL","MAYO","JUNIO",
      "JULIO","AGOSTO","SEPTIEMBRE","OCTUBRE","NOVIEMBRE","DICIEMBRE"
    ];

    // ====== HELPERS ======
    const pad = n => String(n).padStart(2,"0");
    const toISO = (d) => ${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())};
    const toDisplay = (d) => ${pad(d.getDate())}/${pad(d.getMonth()+1)}/${d.getFullYear()};

    function parseISO(iso){
      const [y,m,day] = iso.split("-").map(Number);
      return new Date(y, m-1, day);
    }

    function nightsBetween(checkInISO, checkOutISO){
      const a = parseISO(checkInISO);
      const b = parseISO(checkOutISO);
      const ms = b - a;
      return Math.max(0, Math.round(ms / (1000*60*60*24)));
    }

    // Bloquea si la noche incluye alguna fecha ocupada dentro del rango [in, out)
    function rangeHitsBlocked(checkInISO, checkOutISO){
      const inD = parseISO(checkInISO);
      const outD = parseISO(checkOutISO);
      for (let d = new Date(inD); d < outD; d.setDate(d.getDate()+1)){
        if (blockedDates.has(toISO(d))) return true;
      }
      return false;
    }

    // ====== STATE ======
    let viewDate = new Date(); // mes actual en vista
    let startISO = null;
    let endISO = null;

    // ====== DOM ======
    const monthLabel = document.getElementById("monthLabel");
    const calendarGrid = document.getElementById("calendarGrid");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const todayBtn = document.getElementById("todayBtn");

    const checkInEl = document.getElementById("checkIn");
    const checkOutEl = document.getElementById("checkOut");
    const roomTypeEl = document.getElementById("roomType");
    const nightsEl = document.getElementById("nights");
    const priceNightEl = document.getElementById("priceNight");
    const totalEl = document.getElementById("total");
    const warningEl = document.getElementById("warning");
    const clearBtn = document.getElementById("clearBtn");
    const confirmBtn = document.getElementById("confirmBtn");

    function renderCalendar(){
      const year = viewDate.getFullYear();
      const month = viewDate.getMonth();

      monthLabel.textContent = ${monthNames[month]} ${year};

      calendarGrid.innerHTML = "";

      const first = new Date(year, month, 1);
      const last = new Date(year, month+1, 0);

      const startDay = first.getDay(); // 0 dom ... 6 sáb
      const daysInMonth = last.getDate();

      // Días “previos” del mes anterior para completar la fila
      const prevMonthLast = new Date(year, month, 0).getDate();
      for(let i=0; i<startDay; i++){
        const dayNum = prevMonthLast - (startDay-1-i);
        const cell = document.createElement("div");
        cell.className = "day muted";
        cell.textContent = dayNum;
        calendarGrid.appendChild(cell);
      }

      // Días del mes actual
      for(let day=1; day<=daysInMonth; day++){
        const d = new Date(year, month, day);
        const iso = toISO(d);

        const cell = document.createElement("div");
        cell.className = "day";
        cell.textContent = day;

        if (blockedDates.has(iso)){
          cell.classList.add("blocked");
          const b = document.createElement("div");
          b.className = "badge";
          b.textContent = "OCUPADA";
          cell.appendChild(b);
        }

        // selection UI
        if (startISO === iso || endISO === iso) cell.classList.add("selected");
        if (startISO && endISO){
          const s = parseISO(startISO);
          const e = parseISO(endISO);
          if (d > s && d < e) cell.classList.add("inrange");
        }

        // click handler
        cell.addEventListener("click", () => {
          if (blockedDates.has(iso)) return;

          // si no hay inicio, set inicio
          if (!startISO || (startISO && endISO)){
            startISO = iso;
            endISO = null;
          } else {
            // set fin (debe ser posterior a inicio)
            if (parseISO(iso) <= parseISO(startISO)){
              // si selecciona una anterior, la tomamos como nuevo inicio
              startISO = iso;
              endISO = null;
            } else {
              endISO = iso;

              // validar rango contra bloqueadas
              if (rangeHitsBlocked(startISO, endISO)){
                warningEl.style.display = "block";
                warningEl.textContent = "Tu rango incluye fechas ocupadas. Elige otras fechas.";
                endISO = null;
              } else {
                warningEl.style.display = "none";
                warningEl.textContent = "";
              }
            }
          }

          syncForm();
          renderCalendar();
        });

        calendarGrid.appendChild(cell);
      }

      // Completar hasta múltiplo de 7 con celdas mudas
      const totalCells = calendarGrid.children.length;
      const remainder = totalCells % 7;
      const toAdd = remainder === 0 ? 0 : (7 - remainder);
      for(let i=0; i<toAdd; i++){
        const cell = document.createElement("div");
        cell.className = "day muted";
        cell.textContent = "";
        calendarGrid.appendChild(cell);
      }
    }

    function syncForm(){
      checkInEl.value = startISO ? toDisplay(parseISO(startISO)) : "";
      checkOutEl.value = endISO ? toDisplay(parseISO(endISO)) : "";

      const price = Number(roomTypeEl.value || 0);
      priceNightEl.textContent = ${price} €;

      const n = (startISO && endISO) ? nightsBetween(startISO, endISO) : 0;
      nightsEl.textContent = n;

      const total = price * n;
      totalEl.textContent = ${total} €;
    }

    // nav month
    prevBtn.addEventListener("click", () => {
      viewDate = new Date(viewDate.getFullYear(), viewDate.getMonth()-1, 1);
      renderCalendar();
    });
    nextBtn.addEventListener("click", () => {
      viewDate = new Date(viewDate.getFullYear(), viewDate.getMonth()+1, 1);
      renderCalendar();
    });
    todayBtn.addEventListener("click", () => {
      viewDate = new Date();
      renderCalendar();
    });

    roomTypeEl.addEventListener("change", syncForm);

    clearBtn.addEventListener("click", () => {
      startISO = null;
      endISO = null;
      warningEl.style.display = "none";
      warningEl.textContent = "";
      syncForm();
      renderCalendar();
    });

    confirmBtn.addEventListener("click", () => {
      if (!startISO || !endISO){
        warningEl.style.display = "block";
        warningEl.textContent = "Selecciona fecha de entrada y salida para confirmar.";
        return;
      }
      warningEl.style.display = "none";
      const price = Number(roomTypeEl.value || 0);
      const n = nightsBetween(startISO, endISO);
      const total = price * n;

      alert(
        "✅ Reserva lista (demo)\n\n" +
        Entrada: ${toDisplay(parseISO(startISO))}\n +
        Salida:  ${toDisplay(parseISO(endISO))}\n +
        Noches:  ${n}\n +
        Precio/noche: ${price} €\n +
        Total:   ${total} €\n\n +
        "Luego conectamos el envío por email con backend."
      );
    });

    // ====== INIT ======
    renderCalendar();
    syncForm();
  </script>
</body>
</html>